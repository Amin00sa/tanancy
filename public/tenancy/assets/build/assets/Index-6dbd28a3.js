import{A as P}from"./AppLayout-df16f9ef.js";import{j as B,k as a,o as d,c as v,w as l,b as t,a as s,d as r,m as h,g as b,f as p,l as M,F as O,n as _,t as c}from"./app-8858eae8.js";import{h as Y}from"./moment-fbc5633a.js";import{_ as R}from"./_plugin-vue_export-helper-c27b6911.js";import"./ApplicationLogo-e011a720.js";const q={props:{clients:Object,marches:Object,marche:String,client:String,status:String},components:{AppLayout:P,Link:B},data(){return{showfilter:!1,loading:!1,dialog:!1,deleting:!1,fetchingventes:!0,ventes:[],total:0,totalht:0,totalttc:0,totaltva:0,filter:{date_debut:null,date_fin:null,client:null,marche:null,status:null},options:{},dialogDelete:!1,itemsperpageoptions:[{title:"10",value:10},{title:"25",value:25},{title:"50",value:50},{title:"100",value:100},{title:"Tous",value:-1}],itemsperpagetext:"Lignes par page",headers:[{title:"Numéro de vente",align:"start",sortable:!1,key:"name"},{title:"Objet",sortable:!1,key:"objet"},{title:"Client",sortable:!1,key:"client"},{title:"Date de facturation",sortable:!1,key:"date"},{title:"Montant total TTC",sortable:!1,key:"ttc"},{title:"Statut",sortable:!1,key:"statut"},{title:"Actions",key:"actions",align:"center",sortable:!1}],deletedId:-1,deletedIndex:-1}},watch:{dialogDelete(o){o||this.closeDelete()}},mounted(){this.client&&(this.filter.client=parseInt(this.client)),this.marche&&(this.filter.marche=parseInt(this.marche)),this.status&&(this.filter.status=parseInt(this.status)),this.LoadData(),this.$watch("filter",{handler(){return this.LoadData()},deep:!0}),this.$watch("options",{handler(){return this.LoadData()},deep:!0})},computed:{count(){return this.ventes.length}},methods:{async LoadData(){this.fetchingventes=!0;try{const o=await axios.get("/webapiventes",{params:{page:this.options.page,itemsPerPage:this.options.itemsPerPage,client:this.filter.client,status:this.filter.status,marche:this.filter.marche,date_debut:this.filter.date_debut,date_fin:this.filter.date_fin,search:this.options.search}});this.ventes=[],o.data.ventes.data.length&&(this.ventes=o.data.ventes.data,this.total=o.data.total,this.totalttc=o.data.totalttc,this.totalht=o.data.totalht,this.totaltva=o.data.totaltva)}catch{}this.fetchingventes=!1},deleteItem(o){this.deletedIndex=this.ventes.indexOf(o),this.deletedId=o.id,this.dialogDelete=!0},closeDelete(){this.deletedId=null,this.dialogDelete=!1},deleteItemConfirm(){this.deleting=!0,this.$page.props.flash.success=null,this.$inertia.delete(route("ventes.destroy",this.deletedId),{onSuccess:()=>{this.deleting=!1,this.closeDelete(),this.count===0&&this.options.page>1?this.options.page--:this.LoadData()},preserveScroll:!0})},formatedDate(o){return Y(o).format("DD/MM/YYYY")}}},G=t("h2",{class:"font-semibold text-3xl text-gray-800 leading-tight"},"Ventes",-1),J={class:"my-2 flex justify-center items-center"},K={class:"flex flex-col justify-center mb-5 text-center"},Q={class:"grid grid-cols-2 gap-4"},W={class:"col-span-2 md:col-span-1"},X=t("label",null,"Clients:",-1),Z={class:"col-span-2 md:col-span-1"},$=t("label",null,"Marches:",-1),ee={class:"col-span-2 md:col-span-1"},te=t("label",null,"Statut de paiement:",-1),le={class:"flex justify-between gap-10"},se={class:"font-bold text-gray-600"},ne={key:0,class:"text-sm"},oe=t("span",{class:"font-bold"},"ICE:",-1),ae={key:0},ie={key:1},re={key:0,class:"bg-green-200 text-green-600 rounded p-2"},de={key:1,class:"bg-orange-200 text-orange-600 rounded p-2"},ce=t("span",null,"Détails",-1),ue=t("span",null,"Editer",-1),pe=t("span",null,"Supprimer",-1),_e=t("tr",null,[t("td",{colspan:"4",class:"border-0 h-0"})],-1),me=t("h3",{class:"text-xl font-bold"},"Total:",-1),fe=t("hr",{class:"my-3"},null,-1),he={class:"flex gap-2 justify-end"},ge={class:"flex p-4 justify-center border items-center mb-5 rounded bg-gray-50"},ve=t("span",{class:"text-gray-500 font-bold"},"Total HT: ",-1),be=t("span",{class:"text-gray-500"},"  DH",-1),xe={class:"flex p-4 justify-center border items-center mb-5 rounded bg-gray-50"},ye=t("span",{class:"text-gray-500 font-bold"},"Total TVA: ",-1),ke=t("span",{class:"text-gray-500"},"  DH",-1),Ve={class:"flex p-4 justify-center border items-center mb-5 rounded bg-gray-50"},De=t("span",{class:"text-gray-500 font-bold"},"Total TTC: ",-1),we=t("span",{class:"text-gray-500"},"  DH",-1),Ce={class:"rounded-full bg-opacity-20 p-2 mr-2 bg-red-500"};function Ie(o,i,V,je,e,g){const m=a("v-icon"),I=a("v-badge"),u=a("v-btn"),D=a("v-select"),j=a("v-btn-toggle"),T=a("v-card-text"),w=a("v-card"),L=a("VExpandTransition"),x=a("v-text-field"),C=a("v-sheet"),A=a("v-divider"),S=a("v-spacer"),y=a("Link"),U=a("v-toolbar"),k=a("v-tooltip"),N=a("v-data-table-server"),F=a("v-card-title"),z=a("v-card-actions"),E=a("v-dialog"),H=a("AppLayout");return d(),v(H,{title:"Ventes"},{header:l(()=>[G]),default:l(()=>[t("div",J,[s(u,h(o.props,{active:e.showfilter,variant:"tonal",color:"grey-darken-4",onClick:i[0]||(i[0]=n=>e.showfilter=!e.showfilter)}),{prepend:l(()=>[e.filter.client||e.filter.status||e.filter.marche?(d(),v(I,{key:0,dot:""},{default:l(()=>[s(m,null,{default:l(()=>[r("mdi-filter-outline")]),_:1})]),_:1})):(d(),v(m,{key:1},{default:l(()=>[r("mdi-filter-outline")]),_:1}))]),default:l(()=>[r("Filtre ")]),_:1},16,["active"])]),t("div",K,[s(L,null,{default:l(()=>[e.showfilter?(d(),v(w,{key:0,border:"",elevation:"0",class:"text-start"},{default:l(()=>[s(T,null,{default:l(()=>[t("div",Q,[t("div",W,[X,s(D,{modelValue:e.filter.client,"onUpdate:modelValue":i[1]||(i[1]=n=>e.filter.client=n),class:"mt-1",items:V.clients,"item-value":"id","item-title":"name","no-data-text":"Aucun client",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),t("div",Z,[$,s(D,{modelValue:e.filter.marche,"onUpdate:modelValue":i[2]||(i[2]=n=>e.filter.marche=n),class:"mt-1",items:V.marches,"item-value":"id","item-title":"name","no-data-text":"Aucun marché",variant:"outlined",clearable:""},null,8,["modelValue","items"])]),t("div",ee,[te,s(j,{modelValue:e.filter.status,"onUpdate:modelValue":i[3]||(i[3]=n=>e.filter.status=n),rounded:"1",variant:"flat",divided:"",class:"mt-2 w-full border"},{default:l(()=>[s(u,{value:"paid",class:"w-1/2 h-full",color:"green-accent-4"},{default:l(()=>[r(" Réglé ")]),_:1}),s(u,{value:"pending",class:"w-1/2 h-full",color:"orange-accent-4"},{default:l(()=>[r(" Non réglé ")]),_:1})]),_:1},8,["modelValue"])])])]),_:1})]),_:1})):b("",!0)]),_:1})]),s(C,{border:"",class:"rounded p-4 mb-6"},{default:l(()=>[t("div",le,[s(x,{type:"date",label:"Date de début",modelValue:e.filter.date_debut,"onUpdate:modelValue":i[4]||(i[4]=n=>e.filter.date_debut=n),max:e.filter.date_fin,"hide-details":"",clearable:""},null,8,["modelValue","max"]),s(x,{type:"date",label:"Date de Fin",modelValue:e.filter.date_fin,"onUpdate:modelValue":i[5]||(i[5]=n=>e.filter.date_fin=n),min:e.filter.date_debut,"hide-details":"",clearable:""},null,8,["modelValue","min"])])]),_:1}),s(N,{headers:e.headers,"items-length":e.total,items:e.ventes,"loading-text":"Chargement...",loading:e.fetchingventes,hover:"","items-par-page":e.options.itemsperpage,"items-per-page-text":e.itemsperpagetext,"items-per-page-options":e.itemsperpageoptions,"no-data-text":"Aucune donnée disponible dans la table",class:"border rounded shadow-lg text-sm","onUpdate:options":i[7]||(i[7]=n=>e.options=n)},{headers:l(()=>[t("tr",null,[(d(!0),p(O,null,M(e.headers,n=>(d(),p("th",null,[t("span",se,c(n.title.toUpperCase()),1)]))),256))])]),top:l(()=>[s(U,{color:"white",border:"b",flat:""},{default:l(()=>[s(x,{"prepend-inner-icon":"mdi-magnify",modelValue:e.options.search,"onUpdate:modelValue":i[6]||(i[6]=n=>e.options.search=n),variant:"underline",label:"Rechercher",clearable:"","single-line":"","hide-details":""},null,8,["modelValue"]),s(A,{class:"mx-4",inset:"",vertical:""}),s(S),s(y,{href:o.route("ventes.create")},{default:l(()=>[s(u,h({"prepend-icon":"mdi-plus-box",color:"blue-accent-4",class:"mr-3",variant:"flat"},o.props),{default:l(()=>[r(" Nouvelle vente ")]),_:1},16)]),_:1},8,["href"])]),_:1})]),item:l(({item:n})=>[t("tr",null,[t("td",{class:_({"text-gray-400":e.fetchingventes})},c(n.numero),3),t("td",{class:_({"text-gray-400":e.fetchingventes})},c(n.objet),3),t("td",{class:_({"text-gray-400":e.fetchingventes})},[r(c(n.client.name),1),n.client.ice?(d(),p("div",ne,[oe,r(" "+c(n.client.ice),1)])):b("",!0)],2),t("td",{class:_({"text-gray-400":e.fetchingventes})},[n.date?(d(),p("span",ae,c(g.formatedDate(n.date)),1)):(d(),p("span",ie," - "))],2),t("td",{class:_({"text-gray-400":e.fetchingventes})},c((parseFloat(n.total)+parseFloat(n.total)*parseInt(n.taux_tva)*.01).toFixed(2))+" DH",3),t("td",{class:_({"text-gray-400":e.fetchingventes})},[n.status=="paid"?(d(),p("span",re,[s(m,null,{default:l(()=>[r("mdi-check")]),_:1}),r("Réglé")])):b("",!0),n.status=="pending"?(d(),p("span",de,[s(m,null,{default:l(()=>[r("mdi-clock-outline")]),_:1}),r("Non réglé")])):b("",!0)],2),t("td",null,[s(k,{location:"bottom",origin:""},{activator:l(({props:f})=>[s(y,{href:o.route("ventes.show",n.id)},{default:l(()=>[s(u,h({icon:"mdi-eye",variant:"text"},f,{size:"small",disabled:e.fetchingventes,color:"grey-darken-3",class:"me-2"}),null,16,["disabled"])]),_:2},1032,["href"])]),default:l(()=>[ce]),_:2},1024),s(y,{href:o.route("ventes.edit",n.id)},{default:l(()=>[s(k,{location:"bottom",origin:""},{activator:l(({props:f})=>[s(u,h({icon:"mdi-pencil",variant:"text"},f,{size:"small",disabled:e.fetchingventes,color:"grey-darken-3",class:"me-2"}),null,16,["disabled"])]),default:l(()=>[ue]),_:1})]),_:2},1032,["href"]),s(k,{location:"bottom",origin:""},{activator:l(({props:f})=>[s(u,h({icon:"mdi-delete",variant:"text",disabled:e.fetchingventes,color:"red",onClick:Te=>g.deleteItem(n)},f,{size:"small",class:"me-2"}),null,16,["disabled","onClick"])]),default:l(()=>[pe]),_:2},1024)])]),_e]),_:1},8,["headers","items-length","items","loading","items-par-page","items-per-page-text","items-per-page-options"]),s(C,{color:"grey-white",class:"p-6 mt-4",elevation:"4",border:"",rounded:""},{default:l(()=>[me,fe,t("div",he,[t("div",ge,[ve,r("  "),t("span",null,c(e.totalht),1),be]),t("div",xe,[ye,r("  "),t("span",null,c(e.totaltva),1),ke]),t("div",Ve,[De,r("  "),t("span",null,c(e.totalttc),1),we])])]),_:1}),s(E,{modelValue:e.dialogDelete,"onUpdate:modelValue":i[8]||(i[8]=n=>e.dialogDelete=n),"max-width":"550px"},{default:l(()=>[s(w,null,{default:l(()=>[s(F,{class:"my-2 text-h7"},{default:l(()=>[t("span",Ce,[s(m,{color:"red",size:"small",class:"mb-1",icon:"mdi-alert-outline",variant:"tonal"})]),r(" Êtes-vous sur de vouloir supprimer cette vente? ")]),_:1}),s(z,{class:"bg-gray-100 flex justify-end items-center border-t"},{default:l(()=>[s(u,{color:"gray",class:"mt-2",variant:"text",disabled:e.deleting,onClick:g.closeDelete},{default:l(()=>[r("Annuler")]),_:1},8,["disabled","onClick"]),s(u,{color:"red",class:"mt-2",active:"",variant:"flat",loading:e.deleting,onClick:g.deleteItemConfirm},{default:l(()=>[r("Confirmer")]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const Fe=R(q,[["render",Ie]]);export{Fe as default};
