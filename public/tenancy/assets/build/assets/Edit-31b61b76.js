import{A as w}from"./AppLayout-df16f9ef.js";import{T as E,k as u,o as d,c as x,w as s,b as o,d as R,t as p,a as i,f,g as h,l as Y,F as M,e as C,D as A,E as S}from"./app-8858eae8.js";import{h as U}from"./moment-fbc5633a.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import"./ApplicationLogo-e011a720.js";const H={props:{suppliers:Object,banks:Object,marches:Object,purchase:Object},components:{AppLayout:w},data(){return{files:[],paiement_immediat:!1,valid:!1,loading:!1,marcheRules:[e=>e?!0:"Le marché est obligatoire"],supplierRules:[e=>e?!0:"Le fournisseur est obligatoire"],unityRules:[e=>e?!0:"L'unité est obligatoire"],designationRules:[e=>e?!0:"La désignation est obligatoire"],quantityRules:[e=>e?!0:"La quantité est obligatoire"],priceperunityRules:[e=>/^-?\d+(\.\d+)?$/.test(e)?!0:"La prix par unité doit être numérique"],tvaRules:[e=>e||e===0?!0:"Le taux de TVA est obligatoire"],bankRules:[e=>e?!0:"La banque source est obligatoire"],typeRules:[e=>e?!0:"Le type de paiement est obligatoire"],echeance_dateRules:[e=>e||this.form.paiement_immediat?!0:"La date d'échéance est obligatoire"],dateRules:[e=>e?!0:"La date d'achat est obligatoire"]}},setup(e){return{form:E({marche_id:e.purchase.marche.id,supplier_id:e.purchase.supplier.id,bank_id:e.purchase.bank.id,products:e.purchase.products,taux_tva:e.purchase.payment.taux_tva,date:e.purchase.date?U(e.purchase.date).format("YYYY-MM-DD"):null,paiement_immediat:!!e.purchase.payment.paiement_immediat,echeance_date:e.purchase.payment.echeance_date?U(e.purchase.payment.echeance_date).format("YYYY-MM-DD"):null,total:null,type:null,motif:e.purchase.payment.motif_virement})}},mounted(){this.purchase.payment.type=="cheque"&&(this.form.type="Chèque"),this.purchase.payment.type=="espece"&&(this.form.type="Espèce"),this.purchase.payment.type=="virement"&&(this.form.type="Virement"),this.purchase.payment.type=="versement"&&(this.form.type="Versement"),this.purchase.payment.type=="effet"&&(this.form.type="Effet")},computed:{totalht(){let e=0;return this.form.products.forEach(a=>{if(a.quantity&&a.priceperunity)e+=a.quantity*a.priceperunity;else return 0}),e},now(){return U().format("YYYY-MM-DD")}},methods:{submit(){this.form.total=this.totalht,this.$refs.formulaire.validate().then(()=>{this.valid&&(this.loading=!0,this.$inertia.post(`/purchases/${this.purchase.id}`,{_method:"put",marche_id:this.form.marche_id,supplier_id:this.form.supplier_id,bank_id:this.form.bank_id,products:this.form.products,taux_tva:this.form.taux_tva,paiement_immediat:this.form.paiement_immediat,echeance_date:this.form.echeance_date,date:this.form.date,proof_file:this.files[0],total:this.totalht,motif:this.form.motif,type:this.form.type},{preserveScroll:!0,onSuccess:()=>{this.loading=!1}}))})}}},r=e=>(A("data-v-1b21359c"),e=e(),S(),e),I={class:"text-3xl text-gray-800 leading-tight"},B=r(()=>o("span",{class:"font-semibold"},"Modification d'achat :",-1)),N=r(()=>o("h3",{class:"text-xl font-bold"},"Informations relatives à l'achat:",-1)),O=r(()=>o("hr",{class:"my-3"},null,-1)),J={key:0,class:"flex justify-end"},P=r(()=>o("h3",{class:"text-xl font-bold"},"Articles:",-1)),K=r(()=>o("hr",{class:"my-3"},null,-1)),Q={class:"col-span-5 md:col-span-2 mt-2"},z={class:"col-span-5 md:col-span-3 gap-2 mt-2 grid grid-cols-9"},G={class:"col-span-2 flex items-center"},W={class:"col-span-2 flex items-center"},X={class:"col-span-2 flex items-center"},Z={class:"col-span-2 flex justify-center border items-center mb-5 rounded bg-gray-50"},$={key:0},ee={key:1},te=r(()=>o("span",{class:"text-gray-500"},"  DH HT",-1)),le={class:"flex justify-end col-span-1 mt-1"},ie={class:"flex justify-end mt-2"},ae=r(()=>o("h3",{class:"text-xl font-bold"},"Total:",-1)),oe=r(()=>o("hr",{class:"my-3"},null,-1)),se={class:"flex gap-2 justify-end"},ne={class:"flex p-4 justify-center border items-center mb-5 rounded bg-gray-50"},re=r(()=>o("span",{class:"text-gray-500"},"  DH HT",-1)),de={class:"w-40"},ue={class:"flex p-4 justify-center border items-center mb-5 rounded bg-gray-50"},me={key:0},ce=r(()=>o("span",{class:"text-gray-500"},"  DH TTC",-1)),fe=r(()=>o("h3",{class:"text-xl font-bold"},"Informations relatives au paiement:",-1)),_e=r(()=>o("hr",{class:"my-3"},null,-1)),pe={key:0,class:"flex justify-end"},he={key:0,class:"flex justify-end"},ye=r(()=>o("div",null," Un ordre de virement sera généré automatiquement après l'enregistrement de l'achat",-1)),be=[ye],ve={class:"flex justify-end items-center mt-4"};function Ve(e,a,_,l,n,V){const y=u("v-select"),m=u("v-col"),b=u("v-row"),v=u("v-text-field"),g=u("v-sheet"),k=u("v-btn"),j=u("v-checkbox"),D=u("v-file-input"),L=u("v-form"),T=u("AppLayout");return d(),x(T,{title:"Modification d'achat"},{header:s(()=>[o("h2",I,[B,R(" "+p(_.purchase.numero),1)])]),default:s(()=>[i(L,{disabled:n.loading,modelValue:n.valid,"onUpdate:modelValue":a[11]||(a[11]=t=>n.valid=t),onSubmit:C(V.submit,["prevent"]),ref:"formulaire"},{default:s(()=>[i(g,{color:"grey-white",class:"p-6",border:"",rounded:""},{default:s(()=>[N,O,i(b,null,{default:s(()=>[i(m,{cols:"12",md:"6"},{default:s(()=>[i(y,{modelValue:l.form.marche_id,"onUpdate:modelValue":a[0]||(a[0]=t=>l.form.marche_id=t),items:_.marches,label:"Marché","item-title":"name","item-value":"id",rules:n.marcheRules},null,8,["modelValue","items","rules"])]),_:1}),i(m,{cols:"12",md:"6"},{default:s(()=>[i(y,{modelValue:l.form.supplier_id,"onUpdate:modelValue":a[1]||(a[1]=t=>l.form.supplier_id=t),items:_.suppliers,label:"Fournisseur","item-title":"name","item-value":"id",rules:n.supplierRules},{details:s(()=>[l.form.supplier_id!=null?(d(),f("div",J,[o("div",null,p(_.suppliers.filter(t=>t.id==l.form.supplier_id)[0].bank_name)+" : "+p(_.suppliers.filter(t=>t.id==l.form.supplier_id)[0].bank_rib),1)])):h("",!0)]),_:1},8,["modelValue","items","rules"])]),_:1})]),_:1}),i(b,null,{default:s(()=>[i(m,{cols:"12",md:"6"},{default:s(()=>[i(v,{modelValue:l.form.date,"onUpdate:modelValue":a[2]||(a[2]=t=>l.form.date=t),type:"date",label:"Date d'achat",rules:n.dateRules},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),i(g,{color:"grey-white",class:"p-6 mt-4",border:"",rounded:""},{default:s(()=>[P,K,(d(!0),f(M,null,Y(l.form.products,(t,q)=>(d(),f("div",{class:"grid grid-cols-5 gap-4 border-b",key:q},[o("div",Q,[i(v,{modelValue:t.designation,"onUpdate:modelValue":c=>t.designation=c,label:"Désignation",rules:n.designationRules},null,8,["modelValue","onUpdate:modelValue","rules"])]),o("div",z,[o("div",G,[i(v,{modelValue:t.quantity,"onUpdate:modelValue":c=>t.quantity=c,type:"number",label:"Quantité",min:"1",max:"999",rules:n.quantityRules},null,8,["modelValue","onUpdate:modelValue","rules"])]),o("div",W,[i(y,{modelValue:t.unity,"onUpdate:modelValue":c=>t.unity=c,items:["F","Kg","T","m","m²","m³","l","Journée","Voyage"],label:"Unité",rules:n.unityRules},null,8,["modelValue","onUpdate:modelValue","rules"])]),o("div",X,[i(v,{modelValue:t.priceperunity,"onUpdate:modelValue":c=>t.priceperunity=c,label:"Prix par unité",suffix:"DH HT",min:"0",max:"999",rules:n.priceperunityRules},null,8,["modelValue","onUpdate:modelValue","rules"])]),o("div",Z,[!t.quantity||!t.priceperunity?(d(),f("span",$," 0 ")):(d(),f("span",ee,p((t.priceperunity*t.quantity).toFixed(2)),1)),te]),o("div",le,[i(k,{variant:"text",border:"",icon:"mdi-delete",color:"red",onClick:c=>l.form.products.splice(q,1)},null,8,["onClick"])])])]))),128)),o("div",ie,[i(k,{color:"blue",density:"compact",class:"mb-4","prepend-icon":"mdi-plus-box-outline",variant:"text",onClick:a[3]||(a[3]=t=>l.form.products.push({designation:null,priceperunity:null,quantity:null}))},{default:s(()=>[R("Ajouter un article")]),_:1})]),ae,oe,o("div",se,[o("div",ne,[o("span",null,p(V.totalht.toFixed(2)),1),re]),o("div",de,[i(y,{modelValue:l.form.taux_tva,"onUpdate:modelValue":a[4]||(a[4]=t=>l.form.taux_tva=t),items:[0,7,10,14,20],label:"Taux de TVA",suffix:"%",rules:n.tvaRules},null,8,["modelValue","rules"])]),o("div",ue,[(l.form.taux_tva||l.form.taux_tva===0)&&l.form.products.length?(d(),f("span",me,p((V.totalht+V.totalht*l.form.taux_tva*.01).toFixed(2)),1)):h("",!0),ce])])]),_:1}),i(g,{color:"grey-white",class:"p-6 mt-4",border:"",rounded:""},{default:s(()=>[fe,_e,i(b,null,{default:s(()=>[i(m,{cols:"12",md:"6"},{default:s(()=>[i(y,{modelValue:l.form.bank_id,"onUpdate:modelValue":a[5]||(a[5]=t=>l.form.bank_id=t),items:_.banks,label:"Banque","item-title":"name","item-value":"id",rules:n.bankRules},{details:s(()=>[l.form.bank_id!=null?(d(),f("div",pe,[o("div",null," RIB : "+p(_.banks.filter(t=>t.id==l.form.bank_id)[0].rib),1)])):h("",!0)]),_:1},8,["modelValue","items","rules"])]),_:1}),i(m,{cols:"12",md:"6"},{default:s(()=>[i(y,{modelValue:l.form.type,"onUpdate:modelValue":a[6]||(a[6]=t=>l.form.type=t),items:["Espèce","Chèque","Virement","Effet","Versement"],label:"Type de paiement",rules:n.typeRules},{details:s(()=>[l.form.type==="Virement"?(d(),f("div",he,be)):h("",!0)]),_:1},8,["modelValue","rules"])]),_:1})]),_:1}),l.form.type==="Virement"?(d(),x(b,{key:0},{default:s(()=>[i(m,{cols:"12",md:"6"},{default:s(()=>[i(v,{modelValue:l.form.motif,"onUpdate:modelValue":a[7]||(a[7]=t=>l.form.motif=t),label:"Motif de virement"},null,8,["modelValue"])]),_:1})]),_:1})):h("",!0),l.form.type==="Chèque"||l.form.type==="Effet"?(d(),x(b,{key:1},{default:s(()=>[i(m,{cols:"12",md:"6"},{default:s(()=>[i(j,{modelValue:l.form.paiement_immediat,"onUpdate:modelValue":a[8]||(a[8]=t=>l.form.paiement_immediat=t),label:"Paiement immédiat"},null,8,["modelValue"])]),_:1}),i(m,{cols:"12",md:"6"},{default:s(()=>[i(v,{modelValue:l.form.echeance_date,"onUpdate:modelValue":a[9]||(a[9]=t=>l.form.echeance_date=t),label:"Date d'échéance",type:"date",min:V.now,rules:n.echeance_dateRules,disabled:l.form.paiement_immediat},null,8,["modelValue","min","rules","disabled"])]),_:1})]),_:1})):h("",!0),l.form.type!="Virement"&&l.form.type!=null?(d(),x(b,{key:2},{default:s(()=>[i(m,{cols:"12",md:"6"},{default:s(()=>[i(D,{label:"Justificatif",modelValue:n.files,"onUpdate:modelValue":a[10]||(a[10]=t=>n.files=t),accept:"image/*,application/pdf"},null,8,["modelValue"])]),_:1})]),_:1})):h("",!0)]),_:1}),o("div",ve,[i(k,{variant:"flat",loading:n.loading,type:"submit",color:"blue-accent-4"},{default:s(()=>[R(" Enregistrer ")]),_:1},8,["loading"])])]),_:1},8,["disabled","modelValue","onSubmit"])]),_:1})}const qe=F(H,[["render",Ve],["__scopeId","data-v-1b21359c"]]);export{qe as default};
