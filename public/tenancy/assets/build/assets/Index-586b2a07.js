import{A as j}from"./AppLayout-5088345b.js";import{j as P,k as i,o as b,c as B,w as l,a as e,b as r,f as D,l as O,t as c,F as T,m as _,d as h,e as Y,n as v}from"./app-6f367f05.js";import{h as E}from"./moment-fbc5633a.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import"./ApplicationLogo-691d4996.js";const q={components:{AppLayout:j,Link:P},data(){return{loading:!1,dialog:!1,deleting:!1,fetchingmarches:!0,storevalid:!1,updatevalid:!1,marches:[],total:0,options:{},dialogDelete:!1,itemsperpageoptions:[{title:"10",value:10},{title:"25",value:25},{title:"50",value:50},{title:"100",value:100},{title:"Tous",value:-1}],itemsperpagetext:"Lignes par page",headers:[{title:"Nom",align:"start",sortable:!1,key:"name"},{title:"Maître d'ouvrage",sortable:!1,key:"maitre_ouvrage"},{title:"ville",sortable:!1,key:"ville"},{title:"Date d'ordre de service",sortable:!1,key:"date_service"},{title:"Montant",sortable:!1,key:"montant"},{title:"Actions",key:"actions",align:"center",sortable:!1}],defaultItem:{name:"",maitre_ouvrage:"",ville:"",date_service:"",montant:""},deletedId:-1,deletedIndex:-1,editedIndex:-1,editedId:-1,editedItem:[],editedIndex:-1,nameRules:[o=>o?!0:"Le nom de marche est obligatoire"],maitre_ouvrageRules:[o=>o?!0:"Le maître d'ouvrage est obligatoire"],date_serviceRules:[o=>o?!0:"La date d'ordre de service est obligatoire"]}},watch:{dialogDelete(o){o||this.closeDelete()}},mounted(){this.LoadData(),this.$watch("options",{handler(){return this.LoadData()},deep:!0})},computed:{count(){return this.marches.length},formTitle(){return this.editedIndex===-1?"Nouveau marché":"Modification de marché"}},methods:{async LoadData(){this.fetchingmarches=!0;try{const o=await axios.get("/webapimarches",{params:{page:this.options.page,itemsPerPage:this.options.itemsPerPage,search:this.options.search}});this.marches=[],o.data.marches.data.length&&(this.marches=o.data.marches.data,this.total=o.data.total)}catch{}this.fetchingmarches=!1},store(){this.$refs.storeform.validate().then(()=>{this.storevalid&&(this.loading=!0,this.editedIndex===-1?this.$inertia.post(route("marches.store"),{name:this.editedItem.name,maitre_ouvrage:this.editedItem.maitre_ouvrage,ville:this.editedItem.ville,date_service:this.editedItem.date_service,montant:this.editedItem.montant},{onSuccess:async()=>{this.loading=!1,this.close(),await this.LoadData()},preserveScroll:!0}):this.$inertia.post(route("marches.update",this.editedId),{_method:"put",name:this.editedItem.name,maitre_ouvrage:this.editedItem.maitre_ouvrage,ville:this.editedItem.ville,date_service:this.editedItem.date_service,montant:this.editedItem.montant},{onSuccess:async()=>{this.loading=!1,this.close(),await this.LoadData()},preserveScroll:!0}))})},close(){this.dialog=!1,this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1,this.editedId=-1},deleteItem(o){this.deletedIndex=this.marches.indexOf(o),this.deletedId=o.id,this.dialogDelete=!0},closeDelete(){this.deletedId=null,this.dialogDelete=!1},deleteItemConfirm(){this.deleting=!0,this.$inertia.delete(route("marches.destroy",this.deletedId),{onSuccess:()=>{this.deleting=!1,this.closeDelete(),this.count===0&&this.options.page>1?this.options.page--:this.LoadData()},preserveScroll:!0})},editItem(o){this.editedIndex=this.marches.indexOf(o),this.editedItem=Object.assign({},o),this.editedId=o.id,this.dialog=!0},formatedDate(o){return E(o).format("DD/MM/YYYY")}}},G=r("h2",{class:"font-semibold text-3xl text-gray-800 leading-tight"},"Marchés",-1),H={class:"font-bold text-gray-600"},J={class:"text-h6 font-bold"},K=r("span",null,"Achats",-1),Q=r("span",null,"Vente",-1),W=r("span",null,"Editer",-1),X=r("span",null,"Supprimer",-1),Z=r("tr",null,[r("td",{colspan:"4",class:"border-0 h-0"})],-1),$={class:"rounded-full bg-opacity-20 p-2 mr-2 bg-red-500"};function ee(o,s,te,le,t,d){const u=i("v-text-field"),C=i("v-divider"),L=i("v-spacer"),n=i("v-btn"),x=i("v-card-title"),p=i("v-col"),f=i("v-row"),w=i("v-container"),U=i("v-card-text"),I=i("v-card-actions"),y=i("v-card"),M=i("v-form"),V=i("v-dialog"),S=i("v-toolbar"),k=i("Link"),g=i("v-tooltip"),A=i("v-data-table-server"),N=i("v-icon"),R=i("AppLayout");return b(),B(R,{title:"Marchés"},{header:l(()=>[G]),default:l(()=>[e(A,{headers:t.headers,"items-length":t.total,items:t.marches,"loading-text":"Chargement...",loading:t.fetchingmarches,hover:"","items-par-page":t.options.itemsperpage,"items-per-page-text":t.itemsperpagetext,"items-per-page-options":t.itemsperpageoptions,"no-data-text":"Aucune donnée disponible dans la table",class:"border rounded shadow-lg text-sm","onUpdate:options":s[8]||(s[8]=a=>t.options=a)},{headers:l(()=>[r("tr",null,[(b(!0),D(T,null,O(t.headers,a=>(b(),D("th",null,[r("span",H,c(a.title.toUpperCase()),1)]))),256))])]),top:l(()=>[e(S,{color:"white",border:"b",flat:""},{default:l(()=>[e(u,{"prepend-inner-icon":"mdi-magnify",modelValue:t.options.search,"onUpdate:modelValue":s[0]||(s[0]=a=>t.options.search=a),variant:"underline",label:"Rechercher",clearable:"","single-line":"","hide-details":""},null,8,["modelValue"]),e(C,{class:"mx-4",inset:"",vertical:""}),e(L),e(V,{modelValue:t.dialog,"onUpdate:modelValue":s[7]||(s[7]=a=>t.dialog=a),"max-width":"500px",persistent:""},{activator:l(({props:a})=>[e(n,_({"prepend-icon":"mdi-folder-plus",color:"blue-accent-4",class:"mr-3",variant:"flat"},a),{default:l(()=>[h(" Nouveau marché ")]),_:2},1040)]),default:l(()=>[e(M,{modelValue:t.storevalid,"onUpdate:modelValue":s[6]||(s[6]=a=>t.storevalid=a),disabled:t.loading,onSubmit:Y(d.store,["prevent"]),ref:"storeform"},{default:l(()=>[e(y,null,{default:l(()=>[e(x,{class:"border-b bg-gray-50"},{default:l(()=>[r("span",J,c(d.formTitle),1)]),_:1}),e(U,{class:"max-h-96 overflow-y-auto"},{default:l(()=>[e(w,null,{default:l(()=>[e(f,null,{default:l(()=>[e(p,{cols:"12",sm:"6"},{default:l(()=>[e(u,{modelValue:t.editedItem.name,"onUpdate:modelValue":s[1]||(s[1]=a=>t.editedItem.name=a),label:"Nom",variant:"outlined",rules:t.nameRules},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",sm:"6"},{default:l(()=>[e(u,{modelValue:t.editedItem.maitre_ouvrage,"onUpdate:modelValue":s[2]||(s[2]=a=>t.editedItem.maitre_ouvrage=a),variant:"outlined",label:"Maître d'ouvrage",rules:t.maitre_ouvrageRules},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(f,null,{default:l(()=>[e(p,{cols:"12",sm:"6"},{default:l(()=>[e(u,{modelValue:t.editedItem.ville,"onUpdate:modelValue":s[3]||(s[3]=a=>t.editedItem.ville=a),variant:"outlined",label:"Ville"},null,8,["modelValue"])]),_:1}),e(p,{cols:"12",sm:"6"},{default:l(()=>[e(u,{modelValue:t.editedItem.montant,"onUpdate:modelValue":s[4]||(s[4]=a=>t.editedItem.montant=a),variant:"outlined",label:"Montant"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,null,{default:l(()=>[e(p,{cols:"12",sm:"12"},{default:l(()=>[e(u,{modelValue:t.editedItem.date_service,"onUpdate:modelValue":s[5]||(s[5]=a=>t.editedItem.date_service=a),type:"date",variant:"outlined",label:"Date d'ordre de service",rules:t.date_serviceRules},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),e(I,{class:"bg-gray-100 flex justify-end items-center border-t"},{default:l(()=>[e(n,{color:"gray",class:"mt-2",variant:"text",disabled:t.loading,onClick:d.close},{default:l(()=>[h("Annuler")]),_:1},8,["disabled","onClick"]),e(n,{color:"blue-accent-4",type:"submit",class:"mt-2",active:"",variant:"flat",loading:t.loading},{default:l(()=>[h("Enregistrer")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1})]),item:l(({item:a})=>[r("tr",null,[r("td",{class:v({"text-gray-400":t.fetchingmarches})},c(a.name),3),r("td",{class:v({"text-gray-400":t.fetchingmarches})},c(a.maitre_ouvrage),3),r("td",{class:v({"text-gray-400":t.fetchingmarches})},c(a.ville),3),r("td",{class:v({"text-gray-400":t.fetchingmarches})},c(d.formatedDate(a.date_service)),3),r("td",{class:v({"text-gray-400":t.fetchingmarches})},c(a.montant),3),r("td",null,[e(g,{location:"bottom",origin:""},{activator:l(({props:m})=>[e(k,{href:o.route("purchases.index",{marche:a.id})},{default:l(()=>[e(n,_({icon:"mdi-bank-transfer-out",variant:"text"},m,{size:"small",disabled:t.fetchingmarches,color:"grey-darken-3",class:"me-2"}),null,16,["disabled"])]),_:2},1032,["href"])]),default:l(()=>[K]),_:2},1024),e(g,{location:"bottom",origin:""},{activator:l(({props:m})=>[e(k,{href:o.route("ventes.index",{marche:a.id})},{default:l(()=>[e(n,_({icon:"mdi-bank-transfer-in",variant:"text"},m,{size:"small",disabled:t.fetchingmarches,color:"grey-darken-3",class:"me-2"}),null,16,["disabled"])]),_:2},1032,["href"])]),default:l(()=>[Q]),_:2},1024),e(g,{location:"bottom",origin:""},{activator:l(({props:m})=>[e(n,_({icon:"mdi-pencil",onClick:z=>d.editItem(a),variant:"text"},m,{size:"small",disabled:t.fetchingmarches,color:"grey-darken-3",class:"me-2"}),null,16,["onClick","disabled"])]),default:l(()=>[W]),_:2},1024),e(g,{location:"bottom",origin:""},{activator:l(({props:m})=>[e(n,_({icon:"mdi-delete",variant:"text",disabled:t.fetchingmarches,color:"red",onClick:z=>d.deleteItem(a)},m,{size:"small",class:"me-2"}),null,16,["disabled","onClick"])]),default:l(()=>[X]),_:2},1024)])]),Z]),_:1},8,["headers","items-length","items","loading","items-par-page","items-per-page-text","items-per-page-options"]),e(V,{modelValue:t.dialogDelete,"onUpdate:modelValue":s[9]||(s[9]=a=>t.dialogDelete=a),"max-width":"550px"},{default:l(()=>[e(y,null,{default:l(()=>[e(x,{class:"my-2 text-h7"},{default:l(()=>[r("span",$,[e(N,{color:"red",size:"small",class:"mb-1",icon:"mdi-alert-outline",variant:"tonal"})]),h(" Êtes-vous sur de vouloir supprimer ce marché? ")]),_:1}),e(I,{class:"bg-gray-100 flex justify-end items-center border-t"},{default:l(()=>[e(n,{color:"gray",class:"mt-2",variant:"text",disabled:t.deleting,onClick:d.closeDelete},{default:l(()=>[h("Annuler")]),_:1},8,["disabled","onClick"]),e(n,{color:"red",class:"mt-2",active:"",variant:"flat",loading:t.deleting,onClick:d.deleteItemConfirm},{default:l(()=>[h("Confirmer")]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ne=F(q,[["render",ee]]);export{ne as default};
