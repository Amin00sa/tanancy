import{A as P}from"./AppLayout-df16f9ef.js";import{j as z,k as n,o as _,c as j,w as l,a as t,b as a,f as V,l as O,F as T,m as f,d as c,e as E,t as m,n as b}from"./app-8858eae8.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import"./ApplicationLogo-e011a720.js";const M={components:{AppLayout:P,Link:z},data(){return{loading:!1,dialog:!1,deleting:!1,fetchingbanks:!0,storevalid:!1,updatevalid:!1,banks:[],total:0,options:{},dialogDelete:!1,itemsperpageoptions:[{title:"10",value:10},{title:"25",value:25},{title:"50",value:50},{title:"100",value:100},{title:"Tous",value:-1}],itemsperpagetext:"Lignes par page",headers:[{title:"Nom",align:"start",sortable:!1,key:"name"},{title:"code",sortable:!1,key:"code"},{title:"RIB",sortable:!1,key:"rib"},{title:"Actions",key:"actions",align:"center",sortable:!1}],defaultItem:{name:"",code:"",rib:""},deletedId:-1,deletedIndex:-1,editedIndex:-1,editedId:-1,editedItem:[],editedIndex:-1,nameRules:[s=>s?!0:"Le nom de la banque est obligatoire"],codeRules:[s=>s?!0:"Le code de la banque est obligatoire"],ribRules:[s=>s?!0:"Le RIB de la banque est obligatoire",s=>/\D/.test(s)?"Le RIB ne peut contenir que des chiffres":!0,s=>(s==null?void 0:s.length)<=24?!0:"Vous ne pouvez pas dépasser 24 chiffres",s=>(s==null?void 0:s.length)===24?!0:"Le RIB doit contenir 24 chiffres"]}},watch:{dialogDelete(s){s||this.closeDelete()}},mounted(){this.LoadData(),this.$watch("options",{handler(){return this.LoadData()},deep:!0})},computed:{count(){return this.banks.length},formTitle(){return this.editedIndex===-1?"Nouvelle Banque":"Modification de banque"}},methods:{async LoadData(){this.fetchingbanks=!0;try{const s=await axios.get("/webapibanks",{params:{page:this.options.page,itemsPerPage:this.options.itemsPerPage,search:this.options.search}});this.banks=[],s.data.banks.data.length&&(this.banks=s.data.banks.data,this.total=s.data.total)}catch{}this.fetchingbanks=!1},store(){this.$refs.storeform.validate().then(()=>{this.storevalid&&(this.loading=!0,this.editedIndex===-1?this.$inertia.post(route("banks.store"),{name:this.editedItem.name,code:this.editedItem.code,rib:this.editedItem.rib},{onSuccess:async()=>{this.loading=!1,this.close(),await this.LoadData()},preserveScroll:!0}):this.$inertia.post(route("banks.update",this.editedId),{_method:"put",name:this.editedItem.name,code:this.editedItem.code,rib:this.editedItem.rib},{onSuccess:async()=>{this.loading=!1,this.close(),await this.LoadData()},preserveScroll:!0}))})},close(){this.dialog=!1,this.editedItem=Object.assign({},this.defaultItem),this.editedIndex=-1,this.editedId=-1},deleteItem(s){this.deletedIndex=this.banks.indexOf(s),this.deletedId=s.id,this.dialogDelete=!0},closeDelete(){this.deletedId=null,this.dialogDelete=!1},deleteItemConfirm(){this.deleting=!0,this.$page.props.flash.success=null,this.$inertia.delete(route("banks.destroy",this.deletedId),{onSuccess:()=>{this.deleting=!1,this.closeDelete(),this.count===0&&this.options.page>1?this.options.page--:this.LoadData()},preserveScroll:!0})},editItem(s){this.editedIndex=this.banks.indexOf(s),this.editedItem=Object.assign({},s),this.editedId=s.id,this.dialog=!0}}},G=a("h2",{class:"font-semibold text-3xl text-gray-800 leading-tight"},"Banques",-1),H={class:"font-bold text-gray-600"},J={class:"text-h6 font-bold"},K=a("span",null,"Achats",-1),Q=a("span",null,"Editer",-1),W=a("span",null,"Supprimer",-1),X=a("tr",null,[a("td",{colspan:"4",class:"border-0 h-0"})],-1),Y={class:"rounded-full bg-opacity-20 p-2 mr-2 bg-red-500"};function Z(s,i,$,ee,e,r){const p=n("v-text-field"),C=n("v-divider"),L=n("v-spacer"),d=n("v-btn"),v=n("v-card-title"),h=n("v-col"),x=n("v-row"),D=n("v-container"),w=n("v-card-text"),k=n("v-card-actions"),I=n("v-card"),B=n("v-form"),y=n("v-dialog"),R=n("v-toolbar"),q=n("Link"),g=n("v-tooltip"),S=n("v-data-table-server"),A=n("v-icon"),U=n("AppLayout");return _(),j(U,{title:"Banques"},{header:l(()=>[G]),default:l(()=>[t(S,{headers:e.headers,"items-length":e.total,items:e.banks,"loading-text":"Chargement...",loading:e.fetchingbanks,hover:"","items-par-page":e.options.itemsperpage,"items-per-page-text":e.itemsperpagetext,"items-per-page-options":e.itemsperpageoptions,"no-data-text":"Aucune donnée disponible dans la table",class:"border rounded shadow-lg text-sm","onUpdate:options":i[6]||(i[6]=o=>e.options=o)},{headers:l(()=>[a("tr",null,[(_(!0),V(T,null,O(e.headers,o=>(_(),V("th",null,[a("span",H,m(o.title.toUpperCase()),1)]))),256))])]),top:l(()=>[t(R,{color:"white",border:"b",flat:""},{default:l(()=>[t(p,{"prepend-inner-icon":"mdi-magnify",modelValue:e.options.search,"onUpdate:modelValue":i[0]||(i[0]=o=>e.options.search=o),variant:"underline",label:"Rechercher",clearable:"","single-line":"","hide-details":""},null,8,["modelValue"]),t(C,{class:"mx-4",inset:"",vertical:""}),t(L),t(y,{modelValue:e.dialog,"onUpdate:modelValue":i[5]||(i[5]=o=>e.dialog=o),"max-width":"500px",persistent:""},{activator:l(({props:o})=>[t(d,f({"prepend-icon":"mdi-bank-plus",color:"blue-accent-4",class:"mr-3",variant:"flat"},o),{default:l(()=>[c(" Nouvelle banque ")]),_:2},1040)]),default:l(()=>[t(B,{modelValue:e.storevalid,"onUpdate:modelValue":i[4]||(i[4]=o=>e.storevalid=o),disabled:e.loading,onSubmit:E(r.store,["prevent"]),ref:"storeform"},{default:l(()=>[t(I,null,{default:l(()=>[t(v,{class:"border-b bg-gray-50"},{default:l(()=>[a("span",J,m(r.formTitle),1)]),_:1}),t(w,{class:"max-h-96 overflow-y-auto"},{default:l(()=>[t(D,null,{default:l(()=>[t(x,null,{default:l(()=>[t(h,{cols:"12",sm:"6"},{default:l(()=>[t(p,{modelValue:e.editedItem.name,"onUpdate:modelValue":i[1]||(i[1]=o=>e.editedItem.name=o),label:"Nom",variant:"outlined",placeholder:"Banque Populaire",rules:e.nameRules},null,8,["modelValue","rules"])]),_:1}),t(h,{cols:"12",sm:"6"},{default:l(()=>[t(p,{modelValue:e.editedItem.code,"onUpdate:modelValue":i[2]||(i[2]=o=>e.editedItem.code=o),variant:"outlined",label:"Code",placeholder:"BP",rules:e.codeRules},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(x,null,{default:l(()=>[t(h,{cols:"12"},{default:l(()=>[t(p,{modelValue:e.editedItem.rib,"onUpdate:modelValue":i[3]||(i[3]=o=>e.editedItem.rib=o),variant:"outlined",class:"mt-1",counter:"24",label:"RIB",rules:e.ribRules},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),t(k,{class:"bg-gray-100 flex justify-end items-center border-t"},{default:l(()=>[t(d,{color:"gray",class:"mt-2",variant:"text",disabled:e.loading,onClick:r.close},{default:l(()=>[c("Annuler")]),_:1},8,["disabled","onClick"]),t(d,{color:"blue-accent-4",type:"submit",class:"mt-2",active:"",variant:"flat",loading:e.loading},{default:l(()=>[c("Enregistrer")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1})]),item:l(({item:o})=>[a("tr",null,[a("td",{class:b({"text-gray-400":e.fetchingbanks})},m(o.name),3),a("td",{class:b({"text-gray-400":e.fetchingbanks})},m(o.code),3),a("td",{class:b({"text-gray-400":e.fetchingbanks})},m(o.rib),3),a("td",null,[t(g,{location:"bottom",origin:""},{activator:l(({props:u})=>[t(q,{href:s.route("purchases.index",{bank:o.id})},{default:l(()=>[t(d,f({icon:"mdi-bank-transfer-out",variant:"text"},u,{size:"small",disabled:e.fetchingbanks,color:"grey-darken-3",class:"me-2"}),null,16,["disabled"])]),_:2},1032,["href"])]),default:l(()=>[K]),_:2},1024),t(g,{location:"bottom",origin:""},{activator:l(({props:u})=>[t(d,f({icon:"mdi-pencil",onClick:N=>r.editItem(o),variant:"text"},u,{size:"small",disabled:e.fetchingbanks,color:"grey-darken-3",class:"me-2"}),null,16,["onClick","disabled"])]),default:l(()=>[Q]),_:2},1024),t(g,{location:"bottom",origin:""},{activator:l(({props:u})=>[t(d,f({icon:"mdi-delete",variant:"text",disabled:e.fetchingbanks,color:"red",onClick:N=>r.deleteItem(o)},u,{size:"small",class:"me-2"}),null,16,["disabled","onClick"])]),default:l(()=>[W]),_:2},1024)])]),X]),_:1},8,["headers","items-length","items","loading","items-par-page","items-per-page-text","items-per-page-options"]),t(y,{modelValue:e.dialogDelete,"onUpdate:modelValue":i[7]||(i[7]=o=>e.dialogDelete=o),"max-width":"550px"},{default:l(()=>[t(I,null,{default:l(()=>[t(v,{class:"my-2 text-h7"},{default:l(()=>[a("span",Y,[t(A,{color:"red",size:"small",class:"mb-1",icon:"mdi-alert-outline",variant:"tonal"})]),c(" Êtes-vous sur de vouloir supprimer cette banque? ")]),_:1}),t(k,{class:"bg-gray-100 flex justify-end items-center border-t"},{default:l(()=>[t(d,{color:"gray",class:"mt-2",variant:"text",disabled:e.deleting,onClick:r.closeDelete},{default:l(()=>[c("Annuler")]),_:1},8,["disabled","onClick"]),t(d,{color:"red",class:"mt-2",active:"",variant:"flat",loading:e.deleting,onClick:r.deleteItemConfirm},{default:l(()=>[c("Confirmer")]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ne=F(M,[["render",Z]]);export{ne as default};
