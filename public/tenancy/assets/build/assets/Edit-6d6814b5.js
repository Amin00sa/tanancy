import{A as C}from"./AppLayout-5088345b.js";import{T as N,k as r,o as f,c as S,w as o,b as i,t as g,a as t,m as D,d as p,e as R,f as h,l as H,F as I,g as E}from"./app-6f367f05.js";import"./moment-fbc5633a.js";import{_ as F}from"./_plugin-vue_export-helper-c27b6911.js";import"./ApplicationLogo-691d4996.js";const B={props:{clients:Object,marches:Object,vente:Object},components:{AppLayout:C},data(){return{clients:this.clients,valid:!1,validclient:!1,dialog:!1,loadingclient:!1,loading:!1,editedItem:{name:""},status:[{title:"Réglé",value:"paid"},{title:"Non Réglé",value:"pending"}],objetRules:[e=>e?!0:`L'objet" est obligatoire`],clientRules:[e=>e?!0:"Le client est obligatoire"],unityRules:[e=>e?!0:"L'unité est obligatoire"],designationRules:[e=>e?!0:"La désignation est obligatoire"],statusRules:[e=>e?!0:"Le statut de paiement est obligatoire"],quantityRules:[e=>e?!0:"La quantité est obligatoire"],priceperunityRules:[e=>/^-?\d+(\.\d+)?$/.test(e)?!0:"La prix par unité doit être numérique"],tvaRules:[e=>e||e===0?!0:"Le taux de TVA est obligatoire"],total_textRules:[e=>e?!0:"Le total en texte est obligatoire"],typeRules:[e=>e?!0:"Le type de paiement est obligatoire"]}},setup(e){return{form:N({client_id:e.vente.client.id,marche_id:e.vente.marche?e.vente.marche.id:null,objet:e.vente.objet,products:e.vente.products,total:null,total_text:e.vente.total_text,taux_tva:e.vente.taux_tva,date:e.vente.date,status:e.vente.status})}},computed:{totalht(){let e=0;return this.form.products.forEach(n=>{if(n.quantity&&n.priceperunity)e+=n.quantity*n.priceperunity;else return 0}),e}},methods:{submit(){this.form.total=this.totalht,this.$refs.formulaire.validate().then(()=>{this.valid&&(this.loading=!0,this.$inertia.post(`/ventes/${this.vente.id}`,{_method:"put",client_id:this.form.client_id,marche_id:this.form.marche_id,objet:this.form.objet,products:this.form.products,total:this.form.total,total_text:this.form.total_text,taux_tva:this.form.taux_tva,date:this.form.date,status:this.form.status},{preserveScroll:!0,onSuccess:()=>{this.loading=!1}}))})},async save(){this.$refs.formclient.validate().then(async()=>{if(this.validclient){this.loadingclient=!0;try{const e=await axios.post("/client/store",{name:this.editedItem.name});e.data.client&&(this.clients.push({id:e.data.client.id,name:e.data.client.name}),this.form.client_id=e.data.client.id)}catch{}}this.loadingclient=!0,this.close()})},close(){this.dialog=!1,this.editedItem.name=""}}},M={class:"font-semibold text-3xl text-gray-800 leading-tight"},O=i("h3",{class:"text-xl font-bold"},"Informations relatives à la vente:",-1),P=i("hr",{class:"my-3"},null,-1),z={class:"flex justify-end items-center"},J=i("span",{class:"text-h6 font-bold"},"Nouveau client",-1),K=i("h3",{class:"text-xl font-bold"},"Articles:",-1),Q=i("hr",{class:"my-3"},null,-1),G={class:"col-span-5 md:col-span-2 mt-2"},W={class:"col-span-5 md:col-span-3 gap-2 mt-2 grid grid-cols-9"},X={class:"col-span-2 flex items-center"},Y={class:"col-span-2 flex items-center"},Z={class:"col-span-2 flex items-center"},$={class:"col-span-2 flex justify-center border items-center mb-5 rounded bg-gray-50"},ee={key:0},te={key:1},le=i("span",{class:"text-gray-500"},"  DH HT",-1),oe={class:"flex justify-end col-span-1 mt-1"},ne={class:"flex justify-end mt-2"},ie=i("h3",{class:"text-xl font-bold"},"Total:",-1),ae=i("hr",{class:"my-3"},null,-1),se={class:"flex gap-2 justify-end"},re={class:"flex p-4 justify-center border items-center mb-5 rounded bg-gray-50"},de=i("span",{class:"text-gray-500"},"  DH HT",-1),ue={class:"w-40"},me={class:"flex p-4 justify-center border items-center mb-5 rounded bg-gray-50"},ce={key:0},_e=i("span",{class:"text-gray-500"},"  DH TTC",-1),fe=i("h3",{class:"text-xl font-bold"},"Informations relatives au paiement:",-1),ve=i("hr",{class:"my-3"},null,-1),pe={class:"flex justify-end items-center mt-4"};function he(e,n,y,s,a,u){const m=r("v-text-field"),c=r("v-col"),b=r("v-row"),v=r("v-select"),_=r("v-btn"),U=r("v-card-title"),L=r("v-container"),k=r("v-card-text"),w=r("v-card-actions"),T=r("v-card"),V=r("v-form"),q=r("v-dialog"),x=r("v-sheet"),A=r("AppLayout");return f(),S(A,{title:"Modification de vente"},{header:o(()=>[i("h2",M,"Modification de vente "+g(y.vente.numero),1)]),default:o(()=>[t(V,{disabled:a.loading,modelValue:a.valid,"onUpdate:modelValue":n[10]||(n[10]=l=>a.valid=l),onSubmit:R(u.submit,["prevent"]),ref:"formulaire"},{default:o(()=>[t(x,{color:"grey-white",class:"p-6",border:"",rounded:""},{default:o(()=>[O,P,t(b,null,{default:o(()=>[t(c,{cols:"12"},{default:o(()=>[t(m,{modelValue:s.form.objet,"onUpdate:modelValue":n[0]||(n[0]=l=>s.form.objet=l),label:"Objet",rules:a.objetRules},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(b,null,{default:o(()=>[t(c,{cols:"12",md:"6"},{default:o(()=>[t(v,{modelValue:s.form.marche_id,"onUpdate:modelValue":n[1]||(n[1]=l=>s.form.marche_id=l),items:y.marches,label:"Marché","item-title":"name","item-value":"id",rules:e.marcheRules},null,8,["modelValue","items","rules"])]),_:1}),t(c,{cols:"12",md:"6"},{default:o(()=>[t(v,{modelValue:s.form.client_id,"onUpdate:modelValue":n[5]||(n[5]=l=>s.form.client_id=l),items:a.clients,label:"Client","no-data-text":"Aucun client enregistré","item-title":"name","item-value":"id",rules:a.clientRules},{details:o(()=>[t(q,{modelValue:a.dialog,"onUpdate:modelValue":n[4]||(n[4]=l=>a.dialog=l),"max-width":"500px",transition:"dialog-top-transition",persistent:""},{activator:o(({props:l})=>[i("div",z,[t(_,D({"prepend-icon":"mdi-plus-circle-outline",color:"blue-accent-4",size:"small",variant:"text"},l),{default:o(()=>[p(" Nouveau client ")]),_:2},1040)])]),default:o(()=>[t(V,{modelValue:a.validclient,"onUpdate:modelValue":n[3]||(n[3]=l=>a.validclient=l),disabled:a.loadingclient,onSubmit:R(u.save,["prevent"]),ref:"formclient"},{default:o(()=>[t(T,null,{default:o(()=>[t(U,{class:"border-b bg-gray-50"},{default:o(()=>[J]),_:1}),t(k,{class:"max-h-96 overflow-y-auto"},{default:o(()=>[t(L,null,{default:o(()=>[t(b,null,{default:o(()=>[t(c,{cols:"12"},{default:o(()=>[t(m,{modelValue:a.editedItem.name,"onUpdate:modelValue":n[2]||(n[2]=l=>a.editedItem.name=l),variant:"outlined",label:"Nom",placeholder:"",rules:e.nameRules},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1}),t(w,{class:"bg-gray-100 flex justify-end items-center border-t"},{default:o(()=>[t(_,{color:"gray",class:"mt-2",variant:"text",disabled:a.loadingclient,onClick:u.close},{default:o(()=>[p("Annuler")]),_:1},8,["disabled","onClick"]),t(_,{color:"blue-accent-4",type:"submit",class:"mt-2",active:"",variant:"flat",loading:a.loadingclient},{default:o(()=>[p("Enregistrer")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue","disabled","onSubmit"])]),_:1},8,["modelValue"])]),_:1},8,["modelValue","items","rules"])]),_:1})]),_:1})]),_:1}),t(x,{color:"grey-white",class:"p-6 mt-4",border:"",rounded:""},{default:o(()=>[K,Q,(f(!0),h(I,null,H(s.form.products,(l,j)=>(f(),h("div",{class:"grid grid-cols-5 gap-4 border-b",key:j},[i("div",G,[t(m,{modelValue:l.designation,"onUpdate:modelValue":d=>l.designation=d,label:"Désignation",rules:a.designationRules},null,8,["modelValue","onUpdate:modelValue","rules"])]),i("div",W,[i("div",X,[t(m,{modelValue:l.quantity,"onUpdate:modelValue":d=>l.quantity=d,type:"number",label:"Quantité",min:"1",max:"999",rules:a.quantityRules},null,8,["modelValue","onUpdate:modelValue","rules"])]),i("div",Y,[t(v,{modelValue:l.unity,"onUpdate:modelValue":d=>l.unity=d,items:["F","Kg","T","m","m²","m³","l","Journée","Voyage"],label:"Unité",rules:a.unityRules},null,8,["modelValue","onUpdate:modelValue","rules"])]),i("div",Z,[t(m,{modelValue:l.priceperunity,"onUpdate:modelValue":d=>l.priceperunity=d,label:"Prix par unité",suffix:"DH HT",min:"0",max:"999",rules:a.priceperunityRules},null,8,["modelValue","onUpdate:modelValue","rules"])]),i("div",$,[!l.quantity||!l.priceperunity?(f(),h("span",ee," 0 ")):(f(),h("span",te,g((l.priceperunity*l.quantity).toFixed(2)),1)),le]),i("div",oe,[t(_,{variant:"text",border:"",icon:"mdi-delete",color:"red",onClick:d=>s.form.products.splice(j,1)},null,8,["onClick"])])])]))),128)),i("div",ne,[t(_,{color:"blue",density:"compact",class:"mb-4","prepend-icon":"mdi-plus-box-outline",variant:"text",onClick:n[6]||(n[6]=l=>s.form.products.push({designation:null,priceperunity:null,quantity:null}))},{default:o(()=>[p("Ajouter un article")]),_:1})]),ie,ae,i("div",se,[i("div",re,[i("span",null,g(u.totalht.toFixed(2)),1),de]),i("div",ue,[t(v,{modelValue:s.form.taux_tva,"onUpdate:modelValue":n[7]||(n[7]=l=>s.form.taux_tva=l),items:[0,7,10,14,20],label:"Taux de TVA",suffix:"%",rules:a.tvaRules},null,8,["modelValue","rules"])]),i("div",me,[(s.form.taux_tva||s.form.taux_tva===0)&&s.form.products.length?(f(),h("span",ce,g((u.totalht+u.totalht*s.form.taux_tva*.01).toFixed(2)),1)):E("",!0),_e])])]),_:1}),t(x,{color:"grey-white",class:"p-6 mt-4",border:"",rounded:""},{default:o(()=>[fe,ve,t(b,null,{default:o(()=>[t(c,{cols:"12",md:"6"},{default:o(()=>[t(v,{modelValue:s.form.status,"onUpdate:modelValue":n[8]||(n[8]=l=>s.form.status=l),items:a.status,label:"Statut de paiement","item-title":"title","item-value":"value",rules:a.statusRules},null,8,["modelValue","items","rules"])]),_:1}),t(c,{cols:"12",md:"6"},{default:o(()=>[t(m,{modelValue:s.form.date,"onUpdate:modelValue":n[9]||(n[9]=l=>s.form.date=l),type:"date",label:"Date de facturation",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),i("div",pe,[t(_,{variant:"flat",loading:a.loading,type:"submit",color:"blue-accent-4"},{default:o(()=>[p(" Enregistrer ")]),_:1},8,["loading"])])]),_:1},8,["disabled","modelValue","onSubmit"])]),_:1})}const je=F(B,[["render",he]]);export{je as default};
